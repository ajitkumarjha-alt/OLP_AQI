<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Air Quality Dashboard</title>
    <style>
        body { background: #0f172a; color: white; font-family: sans-serif; text-align: center; margin: 0; padding: 50px; }
        .grid { display: flex; justify-content: center; gap: 20px; flex-wrap: wrap; }
        .card { background: #1e293b; padding: 30px; border-radius: 15px; width: 250px; }
        .value { font-size: 3em; font-weight: bold; display: block; }
        .unit { color: #94a3b8; }
        .status { margin-top: 20px; color: #4ade80; font-size: 0.9em; }
    </style>
</head>
<body>
    <h1>Office Air Quality</h1>
    <div class="grid">
        <div class="card">
            <span>PM2.5</span>
            <span id="pm25" class="value">--</span>
            <span class="unit">µg/m³</span>
        </div>
        <div class="card">
            <span>CO2</span>
            <span id="co2" class="value">--</span>
            <span class="unit">ppm</span>
        </div>
        <div class="card">
            <span>Humidity</span>
            <span id="humid" class="value">--</span>
            <span class="unit">%</span>
        </div>
    </div>
    <div id="last-update" class="status">Connecting...</div>

    <script>
        const API_KEY = 'YOUR_API_KEY_HERE';
        const UDID = 'YOUR_DEVICE_UDID_HERE';
        const URL = `https://api.kaiterra.com/v1/sensedges/${UDID}/top?key=${API_KEY}`;

        async function updateDashboard() {
            try {
                const response = await fetch(URL);
                const data = await response.json();
                
                // Mapping the Kaiterra parameter codes
                const pm25 = data.find(d => d.param === 'rpm25c')?.points[0].value || '--';
                const co2 = data.find(d => d.param === 'rco2')?.points[0].value || '--';
                const humid = data.find(d => d.param === 'rhumid')?.points[0].value || '--';

                document.getElementById('pm25').innerText = Math.round(pm25);
                document.getElementById('co2').innerText = Math.round(co2);
                document.getElementById('humid').innerText = Math.round(humid);
                document.getElementById('last-update').innerText = "Last Updated: " + new Date().toLocaleTimeString();
            } catch (err) {
                document.getElementById('last-update').innerText = "Update Failed. Retrying...";
            }
        }

        // Run every 60 seconds
        setInterval(updateDashboard, 60000);
        updateDashboard();
    </script>
</body>
</html>
